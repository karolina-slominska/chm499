import tkinter as tk
from tkinter import filedialog
import pandas as pd

def pick_excel_file():
    root = tk.Tk()
    root.withdraw()
    return filedialog.askopenfilename(
        title="Select Excel file",
        filetypes=[("Excel files", "*.xlsx *.xls")]
    )

def save_as_dialog(default_name="cleaned.xlsx"):
    root = tk.Tk()
    root.withdraw()
    file_path = filedialog.asksaveasfilename(
        title="Save cleaned Excel file as",
        defaultextension=".xlsx",
        initialfile=default_name,
        filetypes=[("Excel files", "*.xlsx")]
    )
    root.destroy()
    return file_path

def delete_weak_columns(file_path, min_count=100):
    # Load Excel into pandas DataFrame
    df = pd.read_excel(file_path)

    counts = df.replace(["NA", "N/A", "-", "", "- | - | -"], pd.NA).notna().sum()

    good_cols = counts[counts >= min_count].index
    cleaned = df[good_cols]

    out_file = save_as_dialog()
    if out_file:
        cleaned.to_excel(out_file, index=False)
    return counts[counts < min_count], out_file

if __name__ == "__main__":
    path = pick_excel_file()
    dropped, out_file = delete_weak_columns(path, min_count=100)

    if out_file:
        print(f"\nSaved cleaned file to: {out_file}")
        print("\nDropped columns (<100 filled cells):")
        for col, count in dropped.items():
            print(f" - {col}: {count} filled")
    else:
        print("Save cancelled. No file written.")
